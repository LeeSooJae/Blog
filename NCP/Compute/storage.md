# 스토리지 추가
- 부팅 스토리지가 SSD인 경우 : 추가 스토리지로 HDD, SSD 모두 가능
- 부팅 스토리지가 HDD인 경우 : HDD, SSD 모두 가능하지만, SSD 스토리지는 최신 서버에만 추가 가능. 
**Micro 타입, Bare Metal 서버는 스토리지 추가 X**

스토리지는 최대 2,000GB를 지원, 서버 1대당 16개의 스토리지를 이용할 수 있다. (**Local Disk 서버타입, 2017년 1월 23일 이전에 생성된 서버에 대해서는 1,000GB까지 지원**) 
추가한 스토리지 삭제: 
1. 스토리지를 선택하고 '스토리지 삭제' 기능을 이용하면 삭제할 수 있습니다. 단, 스토리지가 마운트된 상태에서는 스토리지를 삭제할 수 없으므로 마운트를 먼저 해제하시기 바랍니다.
2. linux의 경우 스토리지를 삭제(또는 연결 해제)한 후 반드시 스토리지의 마운트 정보를 /etc/fstab에서 삭제해야 합니다. 마운트 정보가 남아있으면 서버가 재부팅될 때 디스크 인식 실패로 정상적으로 부팅되지 않을 수 있습니다.

### 이용중인 스토리지를 다른 서버로 옮기기
1. 최신 서버에 연결된 스토리지에 한해 가능하다. 2017.8.31 이후에 만든서버(서버 상세정보에 Network Interface 적용 가능 여부가 적용가능인 서버)에 연결할 수 있다.
**Micro 타입, Bare Metal 서버는 스토리지 옮기기 X**


# 스토리지 스냅샷
## 스냅샷으로부터 스토리지를 생성한 후 부팅 오류 방지 가이드
부팅용으로 사용되던 기본 스토리지에 대한 스냅샷을 가지고 스토리지를 만들어 서버에 추가할 경우, Linux(CentOS, Ubuntu) 서버가 추가 스토리지를 부팅용 스토리지로 오인하는 현상이 발생한다. 다음의 가이드를 참고하여 잘못 부팅 되지 않도록 설정.( 윈도우 서버는 해당되지 않는다. )
이런현상이 발생하는 이유는 리눅스 서버는 boot parameter에 부팅을 위한 디스크를 정해진 식별자로 지정한다. 그런데 OS버전이 같을 경우( 보통 디스크 식별자가 동일함 ) 동일한 식별자를 가진 스토리지가 2개이상 존재할 수 있다. 이런 경우 부팅 스토리지를 추가 스토리지로, 스냅샷으로부터 추가된 스토리지를 부팅 스토리지로 잘못 인식할 수 있다.
따라서 스토리지 추가 후 서버를 다시 부팅할 때 부팅 오류가 발생하는 것을 방지하기 위해서는, 추가 스토리지의 식별자를 변경해야 한다.

**CentOS 5.x는 스토리지를 라벨로 식별하고, CentOS 6.x 이상과 Ubuntu12.x 이상은 스토리지를 UUID로 식별한다.**

원래 기본 스토리지였던 스냅샷으로부터 추가 스토리지를 생성해서 Linux 서버에 2번째 스토리지로 붙인 후, root 권한으로 'blkid'라는 명령을 실행하면 다음과 같이 각 스토리지의 장치파일 이름과 함께 라벨(LABEL)과 UUI가 표시되는데 아래와 같이 두 스토리지는 모두 동일하다.


```js
# blkid
/dev/xvda1: LABEL="/" UUID="1cc4eb96-42c4-446b-8b1a-154a15012677" TYPE="ext3" SEC_TYPE="ext2"
/dev/xvdb1: LABEL="/" UUID="1cc4eb96-42c4-446b-8b1a-154a15012677" SEC_TYPE="ext2" TYPE="ext3"
```

### 해결 방법
다음을 설정하여, 추가 스토리지로부터 부팅되는 것을 예방. 기본스토리지였던 스냅샷으로부터 추가 스토리지를 생성해서 Linux 서버에 붙일때는 **운영중** 상태여야한다.

CentOS 5.x는 아래와 같은 명령으로 추가 스토리지에 기본 스토리지 라벨(LABEL)과 다른 라벨을 붙인다.(root 권한 필요)
보통 기본 스토리지의 라벨은 '/'이므로 이와 다른 라벨을 붙이면 된다.

`# tune2fs -L <LABEL> /dev/xvdb1`

예시
`# tune2fs -L /additional /dev/xvdb1`

CentOS 6.x과 Ubuntu 12.x, Ubuntu 14.x는 아래와 같은 명령으로 추가 스토리지 UUID를 기본 스토리지 UUID와 다른 것으로 변경합니다. (root 권한 필요)
UUID는 ‘uuidgen’이라는 명령을 이용해서 새로 생성할 수 있습니다.

`# tune2fs –U <UUID> /dev/xvdb1`

예시
`# tune2fs -U b4545678-01f8-407a-ab74-e59b5c98069a /dev/xvdb1`

CentOS 7.x는 부팅 파티션이 ‘/dev/xvda1’이 아니라 ‘/dev/xvda3’이므로, 이를 추가 스토리지로 붙이면 ‘/dev/xvdb3’와 같이 보입니다. 즉, Linux OS와 다르게 파티션 번호를 의미하는 장치 파일 이름의 끝 번호가 1이 아닌 3이 되는 것입니다. 따라서 아래와 같이 명령을 해야 합니다.

`# tune2fs -U <UUID> /dev/xvdb3`


설정 시 몇 가지 주의 및 참고사항을 알려드립니다.
1. 추가 스토리지가 붙은 순서에 따라 장치 파일 이름이 바뀌므로 주의해야 합니다.
장치 파일 이름은 붙은 순서에 따라 xvda, xvdb, xvdc와 같이 끝의 문자가 알파벳 순으로 변경되어 명명됩니다.

2. /dev/xvda는 기존 스토리지 장치 파일 이름이므로 실수로 그 장치 파일의 라벨이나 UUID를 바꾸지 않도록 주의해야 합니다.
다시 부팅이 안될 수 있습니다.

3. GRUB 설정 파일에 있는 Boot parameter중 하나인 ‘root’의 값을 ‘/dev/xvda1’과 같이 기본 스토리지에 해당하는 장치 파일 이름으로 명명해도 됩니다.

